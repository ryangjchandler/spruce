{"version":3,"file":"spruce.umd.js","sources":["../src/index.js","../src/bus.js"],"sourcesContent":["import EventBus from './bus'\n\nconst Spruce = {\n    el: null,\n\n    events: EventBus,\n\n    start() {\n        this.guardAgainstAlpineMissing()\n\n        this.emit('beforeMount')\n            .insertTargetElementIfNotExists()\n            .setupMagicProp()\n            .emit('mounted')\n    },\n\n    guardAgainstAlpineMissing() {\n        if (!window.Alpine || window.Alpine.version < \"2.5.0\") {\n            throw new Error('[Spruce] Alpine v2.5.0 or greater is not installed');\n        }\n    },\n\n    insertTargetElementIfNotExists() {\n        const el = document.createElement('div')\n\n        el.setAttribute('x-data', '{ stores: {}, subscribers: [] }')\n\n        this.el = el\n\n        window.Alpine.initializeComponent(this.el)\n\n        return this\n    },\n\n    setupMagicProp() {\n        window.Alpine.addMagicProperty('store', function (component) {\n            let subscribers = Spruce.el.__x.$data.subscribers\n\n            if (! subscribers.includes(component)) {\n                subscribers.push(component)\n            }\n\n            return Spruce.el.__x.$data.stores\n        })\n\n        return this\n    },\n\n    update() {\n        console.log('test')\n    },\n\n    stores() {\n        return this.el.__x.$data.stores\n    },\n\n    store(name, state, force = false) {\n        let stores = this.stores()\n\n        if (!stores[name] || force) {\n            stores[name] = state\n        }\n\n        return stores[name]\n    },\n\n    reset(name, state) {\n        this.store(name, state, true)\n    },\n\n    on(name, callback) {\n        return this.events.on(name, callback)\n    },\n\n    once(name, callback) {\n        return this.events.once(name, callback)\n    },\n\n    off(name, callback) {\n        this.events.off(name, callback)\n    },\n\n    emit(name, data = {}) {\n        this.events.emit(name, { ...data, store: this.stores })\n\n        return this\n    },\n\n    watch(target, callback) {\n        if (!target.startsWith('stores.')) {\n            target = `stores.${target}`\n        }\n\n        this.el.__x.$data.$watch(target, callback)\n    }\n}\n\nconst deferrer = window.deferLoadingAlpine || (callback => callback())\n\nwindow.deferLoadingAlpine = function (callback) {\n    window.Spruce = Spruce\n    window.Spruce.start()\n\n    deferrer(callback)\n}\n\nexport default Spruce\n","export default {\n    events: {},\n\n    on(name, callback, once = false) {\n        if (! this.events[name]) {\n            this.events[name] = []\n        }\n\n        this.events[name].push({ callback, once })\n\n        return () => this.off(name, callback)\n    },\n\n    once(name, callback) {\n        this.on(name, callback, true)\n    },\n\n    off(name, callback) {\n        this.events[name] = this.events[name].filter(registerCallback => {\n            return registerCallback.callback !== callback && registerCallback.once !== true\n        })\n    },\n\n    emit(name, data = {}) {\n        if (this.events[name]) {\n            this.events[name].forEach(callback => {\n                callback.callback(data)\n\n                if (callback.once) {\n                    this.off(name, callback)\n                }\n            })\n        }\n\n        // TODO: deal with this for IE11 :(\n        // https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent/CustomEvent#Browser_compatibility#Polyfill\n        window.dispatchEvent(new CustomEvent(`spruce:${name}`, {\n            detail: data,\n            bubbles: true\n        }))\n    }\n}"],"names":["Spruce","el","events","on","name","callback","once","this","push","off","filter","registerCallback","emit","data","forEach","window","dispatchEvent","CustomEvent","detail","bubbles","start","guardAgainstAlpineMissing","insertTargetElementIfNotExists","setupMagicProp","Alpine","version","Error","document","createElement","setAttribute","initializeComponent","addMagicProperty","component","subscribers","__x","$data","includes","stores","update","console","log","store","state","force","reset","watch","target","startsWith","$watch","deferrer","deferLoadingAlpine"],"mappings":"6fAEMA,EAAS,CACXC,GAAI,KAEJC,OCLW,CACXA,OAAQ,GAERC,YAAGC,EAAMC,EAAUC,qCAAO,GAChBC,KAAKL,OAAOE,UACTF,OAAOE,GAAQ,SAGnBF,OAAOE,GAAMI,KAAK,UAAEH,OAAUC,sBAEtBC,EAAKE,IAAIL,EAAMC,KAGhCC,cAAKF,EAAMC,QACFF,GAAGC,EAAMC,GAAU,IAG5BI,aAAIL,EAAMC,QACDH,OAAOE,GAAQG,KAAKL,OAAOE,GAAMM,gBAAOC,UAClCA,EAAiBN,WAAaA,IAAsC,IAA1BM,EAAiBL,QAI1EM,cAAKR,EAAMS,6BAAO,IACVN,KAAKL,OAAOE,SACPF,OAAOE,GAAMU,iBAAQT,GACtBA,EAASA,SAASQ,GAEdR,EAASC,QACJG,IAAIL,EAAMC,KAO3BU,OAAOC,cAAc,IAAIC,sBAAsBb,EAAQ,CACnDc,OAAQL,EACRM,SAAS,OD/BjBC,sBACSC,iCAEAT,KAAK,eACLU,iCACAC,iBACAX,KAAK,YAGdS,yCACSN,OAAOS,QAAUT,OAAOS,OAAOC,QAAU,cACpC,IAAIC,MAAM,uDAIxBJ,8CACUrB,EAAK0B,SAASC,cAAc,cAElC3B,EAAG4B,aAAa,SAAU,wCAErB5B,GAAKA,EAEVc,OAAOS,OAAOM,oBAAoBvB,KAAKN,IAEhCM,MAGXgB,iCACIR,OAAOS,OAAOO,iBAAiB,QAAS,SAAUC,OAC1CC,EAAcjC,EAAOC,GAAGiC,IAAIC,MAAMF,mBAEhCA,EAAYG,SAASJ,IACvBC,EAAYzB,KAAKwB,GAGdhC,EAAOC,GAAGiC,IAAIC,MAAME,SAGxB9B,MAGX+B,kBACIC,QAAQC,IAAI,SAGhBH,yBACW9B,KAAKN,GAAGiC,IAAIC,MAAME,QAG7BI,eAAMrC,EAAMsC,EAAOC,mBAAQ,OACnBN,EAAS9B,KAAK8B,gBAEbA,EAAOjC,KAASuC,IACjBN,EAAOjC,GAAQsC,GAGZL,EAAOjC,IAGlBwC,eAAMxC,EAAMsC,QACHD,MAAMrC,EAAMsC,GAAO,IAG5BvC,YAAGC,EAAMC,UACEE,KAAKL,OAAOC,GAAGC,EAAMC,IAGhCC,cAAKF,EAAMC,UACAE,KAAKL,OAAOI,KAAKF,EAAMC,IAGlCI,aAAIL,EAAMC,QACDH,OAAOO,IAAIL,EAAMC,IAG1BO,cAAKR,EAAMS,yBAAO,SACTX,OAAOU,KAAKR,iWAAWS,GAAM4B,MAAOlC,KAAK8B,UAEvC9B,MAGXsC,eAAMC,EAAQzC,GACLyC,EAAOC,WAAW,aACnBD,EAAU,UAASA,QAGlB7C,GAAGiC,IAAIC,MAAMa,OAAOF,EAAQzC,KAInC4C,EAAWlC,OAAOmC,6BAAuB7C,UAAYA,YAE3DU,OAAOmC,mBAAqB,SAAU7C,GAClCU,OAAOf,OAASA,EAChBe,OAAOf,OAAOoB,QAEd6B,EAAS5C"}