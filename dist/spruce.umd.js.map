{"version":3,"file":"spruce.umd.js","sources":["../src/utils.js","../src/observable.js","../src/index.js"],"sourcesContent":["const compareVersion = require('compare-versions')\n\nexport const isNullOrUndefined = value => {\n    return value === null || value === undefined\n}\n\nexport const isObject = _ => {\n    return Object.getPrototypeOf(_) === Object.prototype\n}\n\nexport const isArray = _ => Array.isArray(_)\n\nexport const getMethods = obj => {\n    let methods = {}\n\n    Object.entries(obj).filter(([_, value]) => typeof value === 'function').forEach(([key, value]) => methods[key] = value)\n\n    return methods\n}\n\nexport const isTesting = () => {\n    return navigator.userAgent, navigator.userAgent.includes(\"Node.js\")\n        || navigator.userAgent.includes(\"jsdom\")\n}\n\nexport const checkForAlpine = () => {\n    if (isTesting()) {\n        return true\n    }\n\n    if (! window.Alpine) {\n        return false\n    }\n\n    return compareVersions.compare(window.Alpine.version, '2.7.0', '>=')\n}","import { isNullOrUndefined, isObject, isArray } from './utils'\n\nexport const createObservable = (target, callbacks) => {\n    Object.entries(target).forEach(([key, value]) => {\n        if (! isNullOrUndefined(value) && (isObject(value) || isArray(value))) {            \n            target[key] = createObservable(value, callbacks)\n        }\n    })\n\n    return new Proxy(target, {\n        get(target, key, receiver) {\n            return callbacks.get(target, key, receiver)\n        },\n        set(target, key, value, receiver) {\n            if (! isNullOrUndefined(value) && (isObject(value) || isArray(value))) {\n                value = createObservable(value, callbacks)\n            }\n\n            let originalValue = target[key]\n\n            target[key] = value\n\n            // Copy watchers from the original value if they exist\n            if (!isNullOrUndefined(originalValue) && !isNullOrUndefined(originalValue.__watchers)) {\n                target[key].__watchers = originalValue.__watchers\n            }\n\n            callbacks.set(target, key, target[key], receiver)\n\n            return true\n        }\n    })\n}","import { getMethods, checkForAlpine, isObject, isArray, isNullOrUndefined } from './utils'\nimport { createObservable } from './observable'\n\nconst Spruce = {\n    stores: {},\n\n    persistenceDriver: window.localStorage,\n\n    persisted: [],\n\n    subscribers: [],\n\n    pendingWatchers: {},\n\n    disableReactivity: false,\n\n    startingCallbacks: [],\n\n    startedCallbacks: [],\n\n    hasStarted: false,\n\n    start() {\n        this.startingCallbacks.forEach(fn => fn())\n\n        this.attach()\n\n        this.stores = createObservable(this.stores, {\n            get: (target, key, receiver) => {\n                if (Object.is(receiver, this.stores) && ['get', 'set', 'toggle', 'call', 'clear'].includes(key)) {\n                    return this[key].bind(this)\n                }\n\n                return Reflect.get(target, key, receiver)\n            },\n            set: (target, key, value, receiver) => {\n                if (this.disableReactivity) {\n                    return\n                }\n\n                this.updateSubscribers()\n\n                this.runWatchers(target, key, value, receiver)\n\n                this.disableReactivity = true\n\n                try {\n                    this.persisted.forEach(this.updateLocalStorage.bind(this))\n                } catch (e) {\n                    // Do nothing here (thanks Safari!)\n                }\n\n                this.disableReactivity = false\n            }\n        })\n\n        this.hasStarted = true\n\n        this.disableReactivity = true\n\n        Object.entries(this.pendingWatchers).forEach(([name, callbacks]) => {\n            callbacks.forEach(callback => this.watch(name, callback))\n        })\n\n        this.disableReactivity = false\n\n        this.startedCallbacks.forEach(fn => fn())\n    },\n\n    starting(callback) {\n        this.startingCallbacks.push(callback)\n    },\n\n    started(callback) {\n        this.startedCallbacks.push(callback)\n    },\n\n    attach() {\n        if (! checkForAlpine()) {\n            throw new Error('[Spruce] You must be using Alpine >= 2.5.0 to use Spruce.')\n        }\n\n        const self = this\n\n        window.Alpine.addMagicProperty('store', el => {\n            self.subscribe(el)\n\n            return self.stores\n        })\n    },\n\n    store(name, state, persist = false) {\n        if (typeof state === 'function') {\n            state = state()\n        }\n        \n        if (persist) {\n            try {\n                this.stores[name] = this.retrieveFromLocalStorage(name, getMethods(state))\n\n                if (!this.persisted.includes(name)) {\n                    this.persisted.push(name)\n                }\n            } catch (e) {\n                // Do nothing here (thanks Safari!)\n            }\n        }\n\n        if (!this.stores[name]) {\n            this.stores[name] = state\n        }\n\n        return this.stores[name]\n    },\n\n    reset(name, state) {\n        if (this.stores[name] === undefined) {\n            return;\n        }\n        \n        this.stores[name] = state\n    },\n\n    delete(name, reload = true) {\n        if (this.stores[name] === undefined) {\n            return false;\n        }\n\n        delete this.stores[name]\n\n        if (reload) {\n            this.updateSubscribers()\n        }\n\n        return true;\n    },\n\n    deleteAll() {\n        const results = Object.keys(this.stores).map(key => this.delete(key, false))\n\n        this.updateSubscribers()\n\n        return !results.some(bool => !bool)\n    },\n\n    subscribe(el) {\n        if (!this.subscribers.includes(el)) {\n            this.subscribers.push(el)\n        }\n\n        return this.stores\n    },\n\n    updateSubscribers() {\n        this.subscribers.filter(el => !!el.__x).forEach(el => {\n            el.__x.updateElements(el)\n        })\n    },\n\n    retrieveFromLocalStorage(name, methods = {}) {\n        const value = this.persistenceDriver.getItem(`__spruce:${name}`)\n\n        if (! value) {\n            return null\n        }\n\n        let storage = JSON.parse(value)\n\n        if (typeof storage === 'object') {\n            storage = Object.assign(methods, storage)\n\n            delete storage.__watchers\n            delete storage.__key_name\n        }\n\n        return storage\n    },\n\n    updateLocalStorage(name) {\n        const store = { ...this.store(name) }\n\n        delete store.__watchers\n        delete store.__key_name\n\n        this.persistenceDriver.setItem(`__spruce:${name}`, JSON.stringify(this.store(name)))\n    },\n\n    get(name, target = this.stores) {\n        return name.split('.').reduce((target, part) => target[part], target)\n    },\n\n    set(name, value, target = this.stores) {\n        if (! isArray(name)) {\n            name = name.split('.')\n        }\n\n        if (name.length === 1) return target[name[0]] = value\n\n        if (target[name[0]]) {\n            return this.set(name.slice(1), value, target[name[0]])\n        } else {\n            target[name[0]] = {}\n\n            return this.set(name.slice(1), value, target[name[0]])\n        }\n    },\n\n    toggle(name) {\n        return this.set(name, ! this.get(name))\n    },\n\n    call(name, ...args) {\n        return this.get(name)(...args)\n    },\n\n    clear(name) {\n        return this.persistenceDriver.removeItem(`__spruce:${name}`)\n    },\n\n    watch(name, callback) {\n        if (! this.hasStarted) {\n            this.pendingWatchers[name] || (this.pendingWatchers[name] = [])\n\n            this.pendingWatchers[name].push(callback)\n\n            return [() => this.unwatch(name, callback)]\n        }\n\n        const nameParts = name.split('.')\n\n        const target = nameParts.reduce((target, part) => {\n            const sub = target[part]\n\n            if (! isNullOrUndefined(sub) && (isObject(sub) || isArray(sub))) {\n                return sub\n            }\n\n            return target\n        }, this.stores)\n\n        /**\n         * If the target object / array is the property\n         * that needs to be watched, a magic `__self` key is\n         * used so that runner can pick up on it later.\n         */\n        const part = Object.is(target, this.get(name)) ? '__self' : nameParts[nameParts.length - 1]\n\n        if (! target.hasOwnProperty('__watchers')) {\n            Object.defineProperty(target, '__watchers', {\n                enumerable: false,\n                value: new Map,\n                configurable: true\n            })\n        }\n        \n        if (! target.__watchers.has(part)) {\n            target.__watchers.set(part, new Set)\n        }\n\n        target.__watchers.get(part).add(callback)\n\n        return [() => this.unwatch(name, callback)]\n    },\n\n    unwatch(name, callback) {\n        const nameParts = name.split('.')\n\n        const target = nameParts.reduce((target, part) => {\n            const sub = target[part]\n\n            if (! isNullOrUndefined(sub) && (isObject(sub) || isArray(sub))) {\n                return sub\n            }\n\n            return target\n        }, this.stores)\n\n        const part = Object.is(target, this.get(name)) ? '__self' : nameParts[nameParts.length - 1]\n        const watchers = target.__watchers\n\n        if (! watchers.has(part)) {\n            return\n        }\n\n        watchers.get(part).delete(callback)\n    },\n\n    watchers(name) {\n        const nameParts = name.split('.')\n\n        const target = nameParts.reduce((target, part) => {\n            const sub = target[part]\n\n            if (! isNullOrUndefined(sub) && (isObject(sub) || isArray(sub))) {\n                return sub\n            }\n\n            return target\n        }, this.stores)\n\n        const part = Object.is(target, this.get(name)) ? '__self' : nameParts[nameParts.length - 1]\n\n        if (! target.__watchers) {\n            return {}\n        }\n\n        return target.__watchers.get(part)\n    },\n\n    runWatchers(target, key, value) {\n        if (! target.__watchers) {\n            return\n        }\n\n        if (target.__watchers.has(key)) {\n            target.__watchers.get(key).forEach(f => f(value))\n        }\n\n        /**\n         * The `__self` key is used for watchers that are registered\n         * to the object or array being updated.\n         */\n        if (target.__watchers.has('__self')) {\n            target.__watchers.get('__self').forEach(f => f(value, key))\n        }\n    },\n\n    persistUsing(driver) {\n        if (this.persisted.length > 0) {\n            console.warn('[Spruce] You have already initialised a persisted store. Changing the driver may cause issues.')\n        }\n\n        if (typeof driver.getItem !== 'function') {\n            throw new Error('[Spruce] The persistence driver must have a `getItem(key)` method.')\n        }\n\n        if (typeof driver.setItem !== 'function') {\n            throw new Error('[Spruce] The persistence driver must have a `setItem(key, value)` method.')\n        }\n\n        if (typeof driver.removeItem !== 'function') {\n            throw new Error('[Spruce] The persistence driver must have a `removeItem(name)` method.')\n        }\n\n        this.persistenceDriver = driver\n    }\n}\n\nwindow.Spruce = Spruce\n\nconst deferrer = window.deferLoadingAlpine || function (callback) { callback() }\n\nwindow.deferLoadingAlpine = function (callback) {\n    window.Spruce.start()\n\n    deferrer(callback)\n}\n\nexport default Spruce\n"],"names":["require","isNullOrUndefined","value","undefined","isObject","_","Object","getPrototypeOf","prototype","isArray","Array","getMethods","obj","methods","entries","filter","forEach","key","isTesting","navigator","userAgent","includes","checkForAlpine","window","Alpine","compareVersions","compare","version","createObservable","target","callbacks","Proxy","get","receiver","set","originalValue","__watchers","Spruce","stores","persistenceDriver","localStorage","persisted","subscribers","pendingWatchers","disableReactivity","startingCallbacks","startedCallbacks","hasStarted","start","fn","attach","is","bind","Reflect","updateSubscribers","runWatchers","updateLocalStorage","e","name","callback","watch","starting","push","started","Error","self","addMagicProperty","el","subscribe","store","state","persist","retrieveFromLocalStorage","reset","delete","reload","deleteAll","results","keys","map","some","bool","__x","updateElements","getItem","storage","JSON","parse","assign","__key_name","setItem","stringify","split","reduce","part","length","slice","toggle","call","args","clear","removeItem","unwatch","nameParts","sub","hasOwnProperty","defineProperty","enumerable","Map","configurable","has","Set","add","watchers","f","persistUsing","driver","console","warn","deferrer","deferLoadingAlpine"],"mappings":";;;;;;IAAuBA,OAAO,CAAC,kBAAD;;IAEvB,MAAMC,iBAAiB,GAAGC,KAAK,IAAI;IACtC,SAAOA,KAAK,KAAK,IAAV,IAAkBA,KAAK,KAAKC,SAAnC;IACH,CAFM;IAIA,MAAMC,QAAQ,GAAGC,CAAC,IAAI;IACzB,SAAOC,MAAM,CAACC,cAAP,CAAsBF,CAAtB,MAA6BC,MAAM,CAACE,SAA3C;IACH,CAFM;IAIA,MAAMC,OAAO,GAAGJ,CAAC,IAAIK,KAAK,CAACD,OAAN,CAAcJ,CAAd,CAArB;IAEA,MAAMM,UAAU,GAAGC,GAAG,IAAI;IAC7B,MAAIC,OAAO,GAAG,EAAd;IAEAP,EAAAA,MAAM,CAACQ,OAAP,CAAeF,GAAf,EAAoBG,MAApB,CAA2B,CAAC,CAACV,CAAD,EAAIH,KAAJ,CAAD,KAAgB,OAAOA,KAAP,KAAiB,UAA5D,EAAwEc,OAAxE,CAAgF,CAAC,CAACC,GAAD,EAAMf,KAAN,CAAD,KAAkBW,OAAO,CAACI,GAAD,CAAP,GAAef,KAAjH;IAEA,SAAOW,OAAP;IACH,CANM;IAQA,MAAMK,SAAS,GAAG,MAAM;IAC3B,SAA4BC,SAAS,CAACC,SAAV,CAAoBC,QAApB,CAA6B,SAA7B,KACrBF,SAAS,CAACC,SAAV,CAAoBC,QAApB,CAA6B,OAA7B,CADP;IAEH,CAHM;IAKA,MAAMC,cAAc,GAAG,MAAM;IAChC,MAAIJ,SAAS,EAAb,EAAiB;IACb,WAAO,IAAP;IACH;;IAED,MAAI,CAAEK,MAAM,CAACC,MAAb,EAAqB;IACjB,WAAO,KAAP;IACH;;IAED,SAAOC,eAAe,CAACC,OAAhB,CAAwBH,MAAM,CAACC,MAAP,CAAcG,OAAtC,EAA+C,OAA/C,EAAwD,IAAxD,CAAP;IACH,CAVM;;ICvBA,MAAMC,gBAAgB,GAAG,CAACC,MAAD,EAASC,SAAT,KAAuB;IACnDxB,EAAAA,MAAM,CAACQ,OAAP,CAAee,MAAf,EAAuBb,OAAvB,CAA+B,CAAC,CAACC,GAAD,EAAMf,KAAN,CAAD,KAAkB;IAC7C,QAAI,CAAED,iBAAiB,CAACC,KAAD,CAAnB,KAA+BE,QAAQ,CAACF,KAAD,CAAR,IAAmBO,OAAO,CAACP,KAAD,CAAzD,CAAJ,EAAuE;IACnE2B,MAAAA,MAAM,CAACZ,GAAD,CAAN,GAAcW,gBAAgB,CAAC1B,KAAD,EAAQ4B,SAAR,CAA9B;IACH;IACJ,GAJD;IAMA,SAAO,IAAIC,KAAJ,CAAUF,MAAV,EAAkB;IACrBG,IAAAA,GAAG,CAACH,MAAD,EAASZ,GAAT,EAAcgB,QAAd,EAAwB;IACvB,aAAOH,SAAS,CAACE,GAAV,CAAcH,MAAd,EAAsBZ,GAAtB,EAA2BgB,QAA3B,CAAP;IACH,KAHoB;;IAIrBC,IAAAA,GAAG,CAACL,MAAD,EAASZ,GAAT,EAAcf,KAAd,EAAqB+B,QAArB,EAA+B;IAC9B,UAAI,CAAEhC,iBAAiB,CAACC,KAAD,CAAnB,KAA+BE,QAAQ,CAACF,KAAD,CAAR,IAAmBO,OAAO,CAACP,KAAD,CAAzD,CAAJ,EAAuE;IACnEA,QAAAA,KAAK,GAAG0B,gBAAgB,CAAC1B,KAAD,EAAQ4B,SAAR,CAAxB;IACH;;IAED,UAAIK,aAAa,GAAGN,MAAM,CAACZ,GAAD,CAA1B;IAEAY,MAAAA,MAAM,CAACZ,GAAD,CAAN,GAAcf,KAAd,CAP8B;;IAU9B,UAAI,CAACD,iBAAiB,CAACkC,aAAD,CAAlB,IAAqC,CAAClC,iBAAiB,CAACkC,aAAa,CAACC,UAAf,CAA3D,EAAuF;IACnFP,QAAAA,MAAM,CAACZ,GAAD,CAAN,CAAYmB,UAAZ,GAAyBD,aAAa,CAACC,UAAvC;IACH;;IAEDN,MAAAA,SAAS,CAACI,GAAV,CAAcL,MAAd,EAAsBZ,GAAtB,EAA2BY,MAAM,CAACZ,GAAD,CAAjC,EAAwCgB,QAAxC;IAEA,aAAO,IAAP;IACH;;IArBoB,GAAlB,CAAP;IAuBH,CA9BM;;UCCDI,MAAM,GAAG;IACXC,EAAAA,MAAM,EAAE,EADG;IAGXC,EAAAA,iBAAiB,EAAEhB,MAAM,CAACiB,YAHf;IAKXC,EAAAA,SAAS,EAAE,EALA;IAOXC,EAAAA,WAAW,EAAE,EAPF;IASXC,EAAAA,eAAe,EAAE,EATN;IAWXC,EAAAA,iBAAiB,EAAE,KAXR;IAaXC,EAAAA,iBAAiB,EAAE,EAbR;IAeXC,EAAAA,gBAAgB,EAAE,EAfP;IAiBXC,EAAAA,UAAU,EAAE,KAjBD;;IAmBXC,EAAAA,KAAK,GAAG;IACJ,SAAKH,iBAAL,CAAuB7B,OAAvB,CAA+BiC,EAAE,IAAIA,EAAE,EAAvC;IAEA,SAAKC,MAAL;IAEA,SAAKZ,MAAL,GAAcV,gBAAgB,CAAC,KAAKU,MAAN,EAAc;IACxCN,MAAAA,GAAG,EAAE,CAACH,MAAD,EAASZ,GAAT,EAAcgB,QAAd,KAA2B;IAC5B,YAAI3B,MAAM,CAAC6C,EAAP,CAAUlB,QAAV,EAAoB,KAAKK,MAAzB,KAAoC,CAAC,KAAD,EAAQ,KAAR,EAAe,QAAf,EAAyB,MAAzB,EAAiC,OAAjC,EAA0CjB,QAA1C,CAAmDJ,GAAnD,CAAxC,EAAiG;IAC7F,iBAAO,KAAKA,GAAL,EAAUmC,IAAV,CAAe,IAAf,CAAP;IACH;;IAED,eAAOC,OAAO,CAACrB,GAAR,CAAYH,MAAZ,EAAoBZ,GAApB,EAAyBgB,QAAzB,CAAP;IACH,OAPuC;IAQxCC,MAAAA,GAAG,EAAE,CAACL,MAAD,EAASZ,GAAT,EAAcf,KAAd,EAAqB+B,QAArB,KAAkC;IACnC,YAAI,KAAKW,iBAAT,EAA4B;IACxB;IACH;;IAED,aAAKU,iBAAL;IAEA,aAAKC,WAAL,CAAiB1B,MAAjB,EAAyBZ,GAAzB,EAA8Bf,KAA9B,EAAqC+B,QAArC;IAEA,aAAKW,iBAAL,GAAyB,IAAzB;;IAEA,YAAI;IACA,eAAKH,SAAL,CAAezB,OAAf,CAAuB,KAAKwC,kBAAL,CAAwBJ,IAAxB,CAA6B,IAA7B,CAAvB;IACH,SAFD,CAEE,OAAOK,CAAP,EAAU;IAEX;;IAED,aAAKb,iBAAL,GAAyB,KAAzB;IACH;IA1BuC,KAAd,CAA9B;IA6BA,SAAKG,UAAL,GAAkB,IAAlB;IAEA,SAAKH,iBAAL,GAAyB,IAAzB;IAEAtC,IAAAA,MAAM,CAACQ,OAAP,CAAe,KAAK6B,eAApB,EAAqC3B,OAArC,CAA6C,CAAC,CAAC0C,IAAD,EAAO5B,SAAP,CAAD,KAAuB;IAChEA,MAAAA,SAAS,CAACd,OAAV,CAAkB2C,QAAQ,IAAI,KAAKC,KAAL,CAAWF,IAAX,EAAiBC,QAAjB,CAA9B;IACH,KAFD;IAIA,SAAKf,iBAAL,GAAyB,KAAzB;IAEA,SAAKE,gBAAL,CAAsB9B,OAAtB,CAA8BiC,EAAE,IAAIA,EAAE,EAAtC;IACH,GAhEU;;IAkEXY,EAAAA,QAAQ,CAACF,QAAD,EAAW;IACf,SAAKd,iBAAL,CAAuBiB,IAAvB,CAA4BH,QAA5B;IACH,GApEU;;IAsEXI,EAAAA,OAAO,CAACJ,QAAD,EAAW;IACd,SAAKb,gBAAL,CAAsBgB,IAAtB,CAA2BH,QAA3B;IACH,GAxEU;;IA0EXT,EAAAA,MAAM,GAAG;IACL,QAAI,CAAE5B,cAAc,EAApB,EAAwB;IACpB,YAAM,IAAI0C,KAAJ,CAAU,2DAAV,CAAN;IACH;;IAED,UAAMC,IAAI,GAAG,IAAb;IAEA1C,IAAAA,MAAM,CAACC,MAAP,CAAc0C,gBAAd,CAA+B,OAA/B,EAAwCC,EAAE,IAAI;IAC1CF,MAAAA,IAAI,CAACG,SAAL,CAAeD,EAAf;IAEA,aAAOF,IAAI,CAAC3B,MAAZ;IACH,KAJD;IAKH,GAtFU;;IAwFX+B,EAAAA,KAAK,CAACX,IAAD,EAAOY,KAAP,EAAcC,OAAO,GAAG,KAAxB,EAA+B;IAChC,QAAI,OAAOD,KAAP,KAAiB,UAArB,EAAiC;IAC7BA,MAAAA,KAAK,GAAGA,KAAK,EAAb;IACH;;IAED,QAAIC,OAAJ,EAAa;IACT,UAAI;IACA,aAAKjC,MAAL,CAAYoB,IAAZ,IAAoB,KAAKc,wBAAL,CAA8Bd,IAA9B,EAAoC/C,UAAU,CAAC2D,KAAD,CAA9C,CAApB;;IAEA,YAAI,CAAC,KAAK7B,SAAL,CAAepB,QAAf,CAAwBqC,IAAxB,CAAL,EAAoC;IAChC,eAAKjB,SAAL,CAAeqB,IAAf,CAAoBJ,IAApB;IACH;IACJ,OAND,CAME,OAAOD,CAAP,EAAU;IAEX;IACJ;;IAED,QAAI,CAAC,KAAKnB,MAAL,CAAYoB,IAAZ,CAAL,EAAwB;IACpB,WAAKpB,MAAL,CAAYoB,IAAZ,IAAoBY,KAApB;IACH;;IAED,WAAO,KAAKhC,MAAL,CAAYoB,IAAZ,CAAP;IACH,GA9GU;;IAgHXe,EAAAA,KAAK,CAACf,IAAD,EAAOY,KAAP,EAAc;IACf,QAAI,KAAKhC,MAAL,CAAYoB,IAAZ,MAAsBvD,SAA1B,EAAqC;IACjC;IACH;;IAED,SAAKmC,MAAL,CAAYoB,IAAZ,IAAoBY,KAApB;IACH,GAtHU;;IAwHXI,EAAAA,MAAM,CAAChB,IAAD,EAAOiB,MAAM,GAAG,IAAhB,EAAsB;IACxB,QAAI,KAAKrC,MAAL,CAAYoB,IAAZ,MAAsBvD,SAA1B,EAAqC;IACjC,aAAO,KAAP;IACH;;IAED,WAAO,KAAKmC,MAAL,CAAYoB,IAAZ,CAAP;;IAEA,QAAIiB,MAAJ,EAAY;IACR,WAAKrB,iBAAL;IACH;;IAED,WAAO,IAAP;IACH,GApIU;;IAsIXsB,EAAAA,SAAS,GAAG;IACR,UAAMC,OAAO,GAAGvE,MAAM,CAACwE,IAAP,CAAY,KAAKxC,MAAjB,EAAyByC,GAAzB,CAA6B9D,GAAG,IAAI,KAAKyD,MAAL,CAAYzD,GAAZ,EAAiB,KAAjB,CAApC,CAAhB;IAEA,SAAKqC,iBAAL;IAEA,WAAO,CAACuB,OAAO,CAACG,IAAR,CAAaC,IAAI,IAAI,CAACA,IAAtB,CAAR;IACH,GA5IU;;IA8IXb,EAAAA,SAAS,CAACD,EAAD,EAAK;IACV,QAAI,CAAC,KAAKzB,WAAL,CAAiBrB,QAAjB,CAA0B8C,EAA1B,CAAL,EAAoC;IAChC,WAAKzB,WAAL,CAAiBoB,IAAjB,CAAsBK,EAAtB;IACH;;IAED,WAAO,KAAK7B,MAAZ;IACH,GApJU;;IAsJXgB,EAAAA,iBAAiB,GAAG;IAChB,SAAKZ,WAAL,CAAiB3B,MAAjB,CAAwBoD,EAAE,IAAI,CAAC,CAACA,EAAE,CAACe,GAAnC,EAAwClE,OAAxC,CAAgDmD,EAAE,IAAI;IAClDA,MAAAA,EAAE,CAACe,GAAH,CAAOC,cAAP,CAAsBhB,EAAtB;IACH,KAFD;IAGH,GA1JU;;IA4JXK,EAAAA,wBAAwB,CAACd,IAAD,EAAO7C,OAAO,GAAG,EAAjB,EAAqB;IACzC,UAAMX,KAAK,GAAG,KAAKqC,iBAAL,CAAuB6C,OAAvB,CAAgC,YAAW1B,IAAK,EAAhD,CAAd;;IAEA,QAAI,CAAExD,KAAN,EAAa;IACT,aAAO,IAAP;IACH;;IAED,QAAImF,OAAO,GAAGC,IAAI,CAACC,KAAL,CAAWrF,KAAX,CAAd;;IAEA,QAAI,OAAOmF,OAAP,KAAmB,QAAvB,EAAiC;IAC7BA,MAAAA,OAAO,GAAG/E,MAAM,CAACkF,MAAP,CAAc3E,OAAd,EAAuBwE,OAAvB,CAAV;IAEA,aAAOA,OAAO,CAACjD,UAAf;IACA,aAAOiD,OAAO,CAACI,UAAf;IACH;;IAED,WAAOJ,OAAP;IACH,GA7KU;;IA+KX7B,EAAAA,kBAAkB,CAACE,IAAD,EAAO;IACrB,KAAc,EAAE,GAAG,KAAKW,KAAL,CAAWX,IAAX;IAAL;IAKd,SAAKnB,iBAAL,CAAuBmD,OAAvB,CAAgC,YAAWhC,IAAK,EAAhD,EAAmD4B,IAAI,CAACK,SAAL,CAAe,KAAKtB,KAAL,CAAWX,IAAX,CAAf,CAAnD;IACH,GAtLU;;IAwLX1B,EAAAA,GAAG,CAAC0B,IAAD,EAAO7B,MAAM,GAAG,KAAKS,MAArB,EAA6B;IAC5B,WAAOoB,IAAI,CAACkC,KAAL,CAAW,GAAX,EAAgBC,MAAhB,CAAuB,CAAChE,MAAD,EAASiE,IAAT,KAAkBjE,MAAM,CAACiE,IAAD,CAA/C,EAAuDjE,MAAvD,CAAP;IACH,GA1LU;;IA4LXK,EAAAA,GAAG,CAACwB,IAAD,EAAOxD,KAAP,EAAc2B,MAAM,GAAG,KAAKS,MAA5B,EAAoC;IACnC,QAAI,CAAE7B,OAAO,CAACiD,IAAD,CAAb,EAAqB;IACjBA,MAAAA,IAAI,GAAGA,IAAI,CAACkC,KAAL,CAAW,GAAX,CAAP;IACH;;IAED,QAAIlC,IAAI,CAACqC,MAAL,KAAgB,CAApB,EAAuB,OAAOlE,MAAM,CAAC6B,IAAI,CAAC,CAAD,CAAL,CAAN,GAAkBxD,KAAzB;;IAEvB,QAAI2B,MAAM,CAAC6B,IAAI,CAAC,CAAD,CAAL,CAAV,EAAqB;IACjB,aAAO,KAAKxB,GAAL,CAASwB,IAAI,CAACsC,KAAL,CAAW,CAAX,CAAT,EAAwB9F,KAAxB,EAA+B2B,MAAM,CAAC6B,IAAI,CAAC,CAAD,CAAL,CAArC,CAAP;IACH,KAFD,MAEO;IACH7B,MAAAA,MAAM,CAAC6B,IAAI,CAAC,CAAD,CAAL,CAAN,GAAkB,EAAlB;IAEA,aAAO,KAAKxB,GAAL,CAASwB,IAAI,CAACsC,KAAL,CAAW,CAAX,CAAT,EAAwB9F,KAAxB,EAA+B2B,MAAM,CAAC6B,IAAI,CAAC,CAAD,CAAL,CAArC,CAAP;IACH;IACJ,GA1MU;;IA4MXuC,EAAAA,MAAM,CAACvC,IAAD,EAAO;IACT,WAAO,KAAKxB,GAAL,CAASwB,IAAT,EAAe,CAAE,KAAK1B,GAAL,CAAS0B,IAAT,CAAjB,CAAP;IACH,GA9MU;;IAgNXwC,EAAAA,IAAI,CAACxC,IAAD,EAAO,GAAGyC,IAAV,EAAgB;IAChB,WAAO,KAAKnE,GAAL,CAAS0B,IAAT,EAAe,GAAGyC,IAAlB,CAAP;IACH,GAlNU;;IAoNXC,EAAAA,KAAK,CAAC1C,IAAD,EAAO;IACR,WAAO,KAAKnB,iBAAL,CAAuB8D,UAAvB,CAAmC,YAAW3C,IAAK,EAAnD,CAAP;IACH,GAtNU;;IAwNXE,EAAAA,KAAK,CAACF,IAAD,EAAOC,QAAP,EAAiB;IAClB,QAAI,CAAE,KAAKZ,UAAX,EAAuB;IACnB,WAAKJ,eAAL,CAAqBe,IAArB,MAA+B,KAAKf,eAAL,CAAqBe,IAArB,IAA6B,EAA5D;IAEA,WAAKf,eAAL,CAAqBe,IAArB,EAA2BI,IAA3B,CAAgCH,QAAhC;IAEA,aAAO,CAAC,MAAM,KAAK2C,OAAL,CAAa5C,IAAb,EAAmBC,QAAnB,CAAP,CAAP;IACH;;IAED,UAAM4C,SAAS,GAAG7C,IAAI,CAACkC,KAAL,CAAW,GAAX,CAAlB;IAEA,UAAM/D,MAAM,GAAG0E,SAAS,CAACV,MAAV,CAAiB,CAAChE,MAAD,EAASiE,IAAT,KAAkB;IAC9C,YAAMU,GAAG,GAAG3E,MAAM,CAACiE,IAAD,CAAlB;;IAEA,UAAI,CAAE7F,iBAAiB,CAACuG,GAAD,CAAnB,KAA6BpG,QAAQ,CAACoG,GAAD,CAAR,IAAiB/F,OAAO,CAAC+F,GAAD,CAArD,CAAJ,EAAiE;IAC7D,eAAOA,GAAP;IACH;;IAED,aAAO3E,MAAP;IACH,KARc,EAQZ,KAAKS,MARO,CAAf;IAUA;IACR;IACA;IACA;IACA;;IACQ,UAAMwD,IAAI,GAAGxF,MAAM,CAAC6C,EAAP,CAAUtB,MAAV,EAAkB,KAAKG,GAAL,CAAS0B,IAAT,CAAlB,IAAoC,QAApC,GAA+C6C,SAAS,CAACA,SAAS,CAACR,MAAV,GAAmB,CAApB,CAArE;;IAEA,QAAI,CAAElE,MAAM,CAAC4E,cAAP,CAAsB,YAAtB,CAAN,EAA2C;IACvCnG,MAAAA,MAAM,CAACoG,cAAP,CAAsB7E,MAAtB,EAA8B,YAA9B,EAA4C;IACxC8E,QAAAA,UAAU,EAAE,KAD4B;IAExCzG,QAAAA,KAAK,EAAE,IAAI0G,GAAJ,EAFiC;IAGxCC,QAAAA,YAAY,EAAE;IAH0B,OAA5C;IAKH;;IAED,QAAI,CAAEhF,MAAM,CAACO,UAAP,CAAkB0E,GAAlB,CAAsBhB,IAAtB,CAAN,EAAmC;IAC/BjE,MAAAA,MAAM,CAACO,UAAP,CAAkBF,GAAlB,CAAsB4D,IAAtB,EAA4B,IAAIiB,GAAJ,EAA5B;IACH;;IAEDlF,IAAAA,MAAM,CAACO,UAAP,CAAkBJ,GAAlB,CAAsB8D,IAAtB,EAA4BkB,GAA5B,CAAgCrD,QAAhC;;IAEA,WAAO,CAAC,MAAM,KAAK2C,OAAL,CAAa5C,IAAb,EAAmBC,QAAnB,CAAP,CAAP;IACH,GAnQU;;IAqQX2C,EAAAA,OAAO,CAAC5C,IAAD,EAAOC,QAAP,EAAiB;IACpB,UAAM4C,SAAS,GAAG7C,IAAI,CAACkC,KAAL,CAAW,GAAX,CAAlB;IAEA,UAAM/D,MAAM,GAAG0E,SAAS,CAACV,MAAV,CAAiB,CAAChE,MAAD,EAASiE,IAAT,KAAkB;IAC9C,YAAMU,GAAG,GAAG3E,MAAM,CAACiE,IAAD,CAAlB;;IAEA,UAAI,CAAE7F,iBAAiB,CAACuG,GAAD,CAAnB,KAA6BpG,QAAQ,CAACoG,GAAD,CAAR,IAAiB/F,OAAO,CAAC+F,GAAD,CAArD,CAAJ,EAAiE;IAC7D,eAAOA,GAAP;IACH;;IAED,aAAO3E,MAAP;IACH,KARc,EAQZ,KAAKS,MARO,CAAf;IAUA,UAAMwD,IAAI,GAAGxF,MAAM,CAAC6C,EAAP,CAAUtB,MAAV,EAAkB,KAAKG,GAAL,CAAS0B,IAAT,CAAlB,IAAoC,QAApC,GAA+C6C,SAAS,CAACA,SAAS,CAACR,MAAV,GAAmB,CAApB,CAArE;IACA,UAAMkB,QAAQ,GAAGpF,MAAM,CAACO,UAAxB;;IAEA,QAAI,CAAE6E,QAAQ,CAACH,GAAT,CAAahB,IAAb,CAAN,EAA0B;IACtB;IACH;;IAEDmB,IAAAA,QAAQ,CAACjF,GAAT,CAAa8D,IAAb,EAAmBpB,MAAnB,CAA0Bf,QAA1B;IACH,GA1RU;;IA4RXsD,EAAAA,QAAQ,CAACvD,IAAD,EAAO;IACX,UAAM6C,SAAS,GAAG7C,IAAI,CAACkC,KAAL,CAAW,GAAX,CAAlB;IAEA,UAAM/D,MAAM,GAAG0E,SAAS,CAACV,MAAV,CAAiB,CAAChE,MAAD,EAASiE,IAAT,KAAkB;IAC9C,YAAMU,GAAG,GAAG3E,MAAM,CAACiE,IAAD,CAAlB;;IAEA,UAAI,CAAE7F,iBAAiB,CAACuG,GAAD,CAAnB,KAA6BpG,QAAQ,CAACoG,GAAD,CAAR,IAAiB/F,OAAO,CAAC+F,GAAD,CAArD,CAAJ,EAAiE;IAC7D,eAAOA,GAAP;IACH;;IAED,aAAO3E,MAAP;IACH,KARc,EAQZ,KAAKS,MARO,CAAf;IAUA,UAAMwD,IAAI,GAAGxF,MAAM,CAAC6C,EAAP,CAAUtB,MAAV,EAAkB,KAAKG,GAAL,CAAS0B,IAAT,CAAlB,IAAoC,QAApC,GAA+C6C,SAAS,CAACA,SAAS,CAACR,MAAV,GAAmB,CAApB,CAArE;;IAEA,QAAI,CAAElE,MAAM,CAACO,UAAb,EAAyB;IACrB,aAAO,EAAP;IACH;;IAED,WAAOP,MAAM,CAACO,UAAP,CAAkBJ,GAAlB,CAAsB8D,IAAtB,CAAP;IACH,GAhTU;;IAkTXvC,EAAAA,WAAW,CAAC1B,MAAD,EAASZ,GAAT,EAAcf,KAAd,EAAqB;IAC5B,QAAI,CAAE2B,MAAM,CAACO,UAAb,EAAyB;IACrB;IACH;;IAED,QAAIP,MAAM,CAACO,UAAP,CAAkB0E,GAAlB,CAAsB7F,GAAtB,CAAJ,EAAgC;IAC5BY,MAAAA,MAAM,CAACO,UAAP,CAAkBJ,GAAlB,CAAsBf,GAAtB,EAA2BD,OAA3B,CAAmCkG,CAAC,IAAIA,CAAC,CAAChH,KAAD,CAAzC;IACH;IAED;IACR;IACA;IACA;;;IACQ,QAAI2B,MAAM,CAACO,UAAP,CAAkB0E,GAAlB,CAAsB,QAAtB,CAAJ,EAAqC;IACjCjF,MAAAA,MAAM,CAACO,UAAP,CAAkBJ,GAAlB,CAAsB,QAAtB,EAAgChB,OAAhC,CAAwCkG,CAAC,IAAIA,CAAC,CAAChH,KAAD,EAAQe,GAAR,CAA9C;IACH;IACJ,GAlUU;;IAoUXkG,EAAAA,YAAY,CAACC,MAAD,EAAS;IACjB,QAAI,KAAK3E,SAAL,CAAesD,MAAf,GAAwB,CAA5B,EAA+B;IAC3BsB,MAAAA,OAAO,CAACC,IAAR,CAAa,gGAAb;IACH;;IAED,QAAI,OAAOF,MAAM,CAAChC,OAAd,KAA0B,UAA9B,EAA0C;IACtC,YAAM,IAAIpB,KAAJ,CAAU,oEAAV,CAAN;IACH;;IAED,QAAI,OAAOoD,MAAM,CAAC1B,OAAd,KAA0B,UAA9B,EAA0C;IACtC,YAAM,IAAI1B,KAAJ,CAAU,2EAAV,CAAN;IACH;;IAED,QAAI,OAAOoD,MAAM,CAACf,UAAd,KAA6B,UAAjC,EAA6C;IACzC,YAAM,IAAIrC,KAAJ,CAAU,wEAAV,CAAN;IACH;;IAED,SAAKzB,iBAAL,GAAyB6E,MAAzB;IACH;;IAtVU;IAyVf7F,MAAM,CAACc,MAAP,GAAgBA,MAAhB;;IAEA,MAAMkF,QAAQ,GAAGhG,MAAM,CAACiG,kBAAP,IAA6B,UAAU7D,QAAV,EAAoB;IAAEA,EAAAA,QAAQ;IAAI,CAAhF;;IAEApC,MAAM,CAACiG,kBAAP,GAA4B,UAAU7D,QAAV,EAAoB;IAC5CpC,EAAAA,MAAM,CAACc,MAAP,CAAcW,KAAd;IAEAuE,EAAAA,QAAQ,CAAC5D,QAAD,CAAR;IACH,CAJD;;;;;;;;"}